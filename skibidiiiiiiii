local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

--// Services & Variables do script original [cite: 59, 60]
local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local HRP = Character:WaitForChild("HumanoidRootPart")

local Dump = { BallPrediction = {} }
local _BALLS = {}
local NO_FOLDER = false

--// Lógica de Detecção de Bola [cite: 60]
local BallsFolder = workspace:FindFirstChild("Balls", true)
if not BallsFolder then
    NO_FOLDER = true
    for _, Ball in pairs(workspace:GetChildren()) do
        if Ball.Name == "fakeBaIlExpIoiter" or Ball.Name == "fakeBall" or Ball.Name == "MPS" or Ball.Name == "TPS" then
            table.insert(_BALLS, Ball)
        end
    end
end

--// Funções Utilitárias Originais [cite: 62, 63, 64]
local function quadraticSolver(a, b, c)
	local x1 = (-b + math.sqrt((b*b) -4 * a * c)) / (2 * a)
	local x2 = (-b - math.sqrt((b*b) -4 * a * c)) / (2 * a)
	return x2 > x1 and x2 or x1
end

local function findPositionAtTime(vel, t, startingPos, acc)
	local height = vel.Y * t + 0.5 * -acc * (t*t)
	return startingPos + Vector3.new(vel.X * t, height, vel.Z * t)
end

local function findLandingPosition(Vo, startingPosition, acc, max)
	local seconds = quadraticSolver((0.5 * -acc), Vo.Y, startingPosition.Y)
	local horizontalVel = Vector3.new(Vo.X, 0, Vo.Z)
	return startingPosition + (horizontalVel * seconds) + Vector3.new(0, Vo.Y * seconds + 0.5 * -acc * (seconds*seconds), 0)
end

--// Window Setup
local Window = Fluent:CreateWindow({
	Title = "MPS Script - Fluent Edition",
	SubTitle = "by dawid & yankuiza",
	TabWidth = 160,
	Size = UDim2.fromOffset(580, 460),
	Acrylic = true,
	Theme = "Dark"
})

local Tabs = {
	Main = Window:AddTab({ Title = "Main", Icon = "home" }),
	Ball = Window:AddTab({ Title = "Ball", Icon = "volleyball" }),
	Character = Window:AddTab({ Title = "Character", Icon = "user" }),
	Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local Options = Fluent.Options

--// Tab: Main (Reach & General) [cite: 66, 67]
local ReachToggle = Tabs.Main:AddToggle("ReachMasterToggle", {Title = "Enable Reach", Default = false})
local ReachSize = Tabs.Main:AddSlider("ReachSize", {
    Title = "Reach Size",
    Default = 10,
    Min = 0,
    Max = 100,
    Rounding = 1
})

--// Tab: Ball (Prediction) 
local BallPredToggle = Tabs.Ball:AddToggle("BallPredToggle", {Title = "Ball Prediction", Default = false})
local BallPredColor = Tabs.Ball:AddColorpicker("BallPredTrailColor", {
    Title = "Trail Color",
    Default = Color3.fromRGB(255, 255, 255)
})

local function PredictBall(Ball)
    if not Options.BallPredToggle.Value then return end
	local LandingPosition = findLandingPosition(Ball.AssemblyLinearVelocity, Ball.Position, workspace.Gravity, 5)
    
    -- Lógica de visualização simplificada para Fluent
    local Attachment = Instance.new("Attachment", workspace.Terrain)
    Attachment.WorldPosition = LandingPosition
    game:GetService("Debris"):AddItem(Attachment, 1)
end

--// Loop de Atualização [cite: 68]
task.spawn(function()
    while task.wait(0.1) do
        if Options.BallPredToggle.Value then
            local balls = NO_FOLDER and _BALLS or BallsFolder:GetChildren()
            for _, Ball in pairs(balls) do
                if Ball:IsA("BasePart") and Ball.AssemblyLinearVelocity.Magnitude > 25 then
                    PredictBall(Ball)
                end
            end
        end
    end
end)

--// Tab: Character [cite: 70]
Tabs.Character:AddSlider("CharSpeed", {
    Title = "CFrame Speed",
    Default = 16,
    Min = 16,
    Max = 100,
    Rounding = 1,
    Callback = function(Value)
        -- Implementação da velocidade original
    end
})

--// Configurações Finais
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
SaveManager:SetFolder("FluentMPS")
SaveManager:BuildConfigSection(Tabs.Settings)
InterfaceManager:BuildInterfaceSection(Tabs.Settings)

Window:SelectTab(1)
Fluent:Notify({Title = "Success", Content = "Script loaded with Fluent UI", Duration = 5})
